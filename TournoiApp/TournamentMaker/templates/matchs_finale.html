{% extends 'base_generic.html' %}

{% block content %}
<h1 style="color: black;">Créer les matchs de la phase finale</h1>

{% if matchs_existent %}
  <p style="color: red; font-weight: bold;">
    Les matchs de la phase finale ont déjà été créés pour ce tournoi. Vous ne pouvez plus en créer d'autres.
  </p>
{% else %}
  <form method="post">
    {% csrf_token %}
    {% for i in match_range %}
    <div class="match-block">
      <h4 style="color: black;">Match {{ i|add:1 }}</h4>

      <label>Équipe A :</label>
      <select name="team_a_{{ i }}" class="team-select" required>
        {% for team in qualified_teams %}
        <option value="{{ team.id }}">{{ team.name }}</option>
        {% endfor %}
      </select>

      <label>Équipe B :</label>
      <select name="team_b_{{ i }}" class="team-select" required>
        {% for team in qualified_teams %}
        <option value="{{ team.id }}">{{ team.name }}</option>
        {% endfor %}
      </select>
    </div>
    <br>
    {% endfor %}

    <button type="submit">Créer les matchs</button>
  </form>
{% endif %}

<script>
  const selects = document.querySelectorAll('.team-select');

  selects.forEach(select => {
    select.addEventListener('change', () => {
      const selectedValues = Array.from(selects)
        .map(s => s.value)
        .filter(v => v !== "");

      selects.forEach(currentSelect => {
        const currentValue = currentSelect.value;

        Array.from(currentSelect.options).forEach(option => {
          if (
            selectedValues.includes(option.value) &&
            option.value !== currentValue
          ) {
            option.disabled = true;
          } else {
            option.disabled = false;
          }
        });
      });
    });
  });
</script>
{% endblock %}
